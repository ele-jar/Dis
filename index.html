<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Server Management Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #7289da;
            --secondary-color: #4a4d52;
            --background-color: #2c2f33;
            --card-background: #23272a;
            --text-color: #ffffff;
            --danger-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background-color: var(--card-background);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .navbar-brand {
            color: var(--primary-color) !important;
            font-weight: bold;
        }

        .card {
            background-color: var(--card-background);
            border: none;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .card-header {
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--primary-color);
            font-weight: bold;
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-primary:hover {
            background-color: #5b6eae;
            border-color: #5b6eae;
        }

        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c0392b;
            border-color: #c0392b;
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #27ae60;
            border-color: #27ae60;
        }

        .form-control, .form-select {
            background-color: var(--background-color);
            color: var(--text-color);
            border: 1px solid var(--secondary-color);
        }

        .form-control:focus, .form-select:focus {
            background-color: var(--background-color);
            color: var(--text-color);
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(114, 137, 218, 0.25);
        }

        .table {
            color: var(--text-color);
        }

        .table-dark {
            --bs-table-bg: var(--secondary-color);
        }

        .modal-content {
            background-color: var(--card-background);
        }

        .modal-header, .modal-footer {
            border-color: var(--secondary-color);
        }

        .nav-tabs .nav-link {
            color: var(--text-color);
        }

        .nav-tabs .nav-link.active {
            background-color: var(--card-background);
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .nav-tabs .nav-link:hover {
            border-color: var(--secondary-color) var(--secondary-color) var(--primary-color);
        }

        .login-container {
            max-width: 400px;
            margin: 100px auto;
        }

        .dashboard {
            display: none;
        }

        .channel-item, .role-item, .member-item {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            background-color: var(--secondary-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-actions {
            display: flex;
            gap: 5px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
            z-index: 1050;
            display: none;
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
        }

        .sidebar {
            background-color: var(--card-background);
            height: calc(100vh - 56px);
            position: fixed;
            top: 56px;
            left: 0;
            width: 250px;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }

        .main-content {
            margin-left: 250px;
            padding: 20px;
        }

        .sidebar .nav-link {
            color: var(--text-color);
            border-radius: 5px;
            padding: 10px 15px;
            margin-bottom: 5px;
        }

        .sidebar .nav-link:hover {
            background-color: var(--secondary-color);
        }

        .sidebar .nav-link.active {
            background-color: var(--primary-color);
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
            }
        }

        .color-picker {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .message-content {
            background-color: var(--secondary-color);
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .message-author {
            font-weight: bold;
            color: var(--primary-color);
        }

        .message-timestamp {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-discord"></i> Discord Server Management
            </a>
            <div class="ms-auto">
                <button id="logoutBtn" class="btn btn-outline-light">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="card">
            <div class="card-header text-center">
                <h4><i class="bi bi-shield-lock"></i> Login to Control Panel</h4>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label for="apiUrl" class="form-label">API URL</label>
                    <input type="text" class="form-control" id="apiUrl" placeholder="http://localhost:3000" value="http://localhost:3000">
                </div>
                <div class="mb-3">
                    <label for="webToken" class="form-label">Web Token</label>
                    <input type="password" class="form-control" id="webToken" placeholder="Enter your web token">
                </div>
                <button id="loginBtn" class="btn btn-primary w-100">
                    <i class="bi bi-box-arrow-in-right"></i> Login
                </button>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="mb-3">
                <label for="guildSelect" class="form-label">Select Server</label>
                <select class="form-select" id="guildSelect">
                    <option value="">Loading servers...</option>
                </select>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-tab="overview">
                        <i class="bi bi-speedometer2"></i> Overview
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="channels">
                        <i class="bi bi-hash"></i> Channels
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="roles">
                        <i class="bi bi-person-badge"></i> Roles
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="members">
                        <i class="bi bi-people"></i> Members
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="messages">
                        <i class="bi bi-chat-dots"></i> Messages
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="settings">
                        <i class="bi bi-gear"></i> Server Settings
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Overview Tab -->
            <div id="overviewTab" class="tab-content">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Channels</h5>
                                <h2 id="channelCount">-</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Roles</h5>
                                <h2 id="roleCount">-</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Members</h5>
                                <h2 id="memberCount">-</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h5 class="card-title">Online</h5>
                                <h2 id="onlineCount">-</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h5><i class="bi bi-info-circle"></i> Server Information</h5>
                    </div>
                    <div class="card-body">
                        <div id="serverInfo">
                            <p>Loading server information...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Channels Tab -->
            <div id="channelsTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="bi bi-hash"></i> Channel Management</h5>
                        <button id="createChannelBtn" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Create Channel
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="channelsList">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Roles Tab -->
            <div id="rolesTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="bi bi-person-badge"></i> Role Management</h5>
                        <button id="createRoleBtn" class="btn btn-primary">
                            <i class="bi bi-plus-circle"></i> Create Role
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="rolesList">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Members Tab -->
            <div id="membersTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="bi bi-people"></i> Member Management</h5>
                        <div>
                            <input type="text" class="form-control" id="memberSearch" placeholder="Search members...">
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="membersList">
                            <div class="loading-spinner">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages Tab -->
            <div id="messagesTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-chat-dots"></i> Message Management</h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="messageChannelSelect" class="form-label">Select Channel</label>
                                <select class="form-select" id="messageChannelSelect">
                                    <option value="">Loading channels...</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="messageLimit" class="form-label">Message Limit</label>
                                <select class="form-select" id="messageLimit">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50" selected>50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <button id="loadMessagesBtn" class="btn btn-primary">
                                <i class="bi bi-arrow-clockwise"></i> Load Messages
                            </button>
                            <button id="sendMessageBtn" class="btn btn-success">
                                <i class="bi bi-send"></i> Send Message
                            </button>
                        </div>
                        <div id="messagesList">
                            <div class="text-center text-muted">
                                Select a channel and click "Load Messages" to view messages
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="bi bi-gear"></i> Server Settings</h5>
                    </div>
                    <div class="card-body">
                        <form id="serverSettingsForm">
                            <div class="mb-3">
                                <label for="serverName" class="form-label">Server Name</label>
                                <input type="text" class="form-control" id="serverName">
                            </div>
                            <div class="mb-3">
                                <label for="serverRegion" class="form-label">Server Region</label>
                                <select class="form-select" id="serverRegion">
                                    <option value="en-US">English (US)</option>
                                    <option value="en-GB">English (UK)</option>
                                    <option value="bg">Bulgarian</option>
                                    <option value="zh-CN">Chinese (China)</option>
                                    <option value="zh-TW">Chinese (Taiwan)</option>
                                    <option value="hr">Croatian</option>
                                    <option value="cs">Czech</option>
                                    <option value="da">Danish</option>
                                    <option value="nl">Dutch</option>
                                    <option value="fi">Finnish</option>
                                    <option value="fr">French</option>
                                    <option value="de">German</option>
                                    <option value="el">Greek</option>
                                    <option value="hi">Hindi</option>
                                    <option value="hu">Hungarian</option>
                                    <option value="it">Italian</option>
                                    <option value="ja">Japanese</option>
                                    <option value="ko">Korean</option>
                                    <option value="lt">Lithuanian</option>
                                    <option value="no">Norwegian</option>
                                    <option value="pl">Polish</option>
                                    <option value="pt-BR">Portuguese (Brazil)</option>
                                    <option value="ro">Romanian</option>
                                    <option value="ru">Russian</option>
                                    <option value="es-ES">Spanish (Spain)</option>
                                    <option value="sv-SE">Swedish</option>
                                    <option value="th">Thai</option>
                                    <option value="tr">Turkish</option>
                                    <option value="uk">Ukrainian</option>
                                    <option value="vi">Vietnamese</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="verificationLevel" class="form-label">Verification Level</label>
                                <select class="form-select" id="verificationLevel">
                                    <option value="0">None</option>
                                    <option value="1">Low</option>
                                    <option value="2">Medium</option>
                                    <option value="3">High</option>
                                    <option value="4">Very High</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="explicitContentFilter" class="form-label">Explicit Content Filter</label>
                                <select class="form-select" id="explicitContentFilter">
                                    <option value="0">Disabled</option>
                                    <option value="1">Members without roles</option>
                                    <option value="2">All members</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="defaultMessageNotifications" class="form-label">Default Notification Level</label>
                                <select class="form-select" id="defaultMessageNotifications">
                                    <option value="0">All messages</option>
                                    <option value="1">Only mentions</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Save Settings
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Create Channel Modal -->
    <div class="modal fade" id="createChannelModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Channel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createChannelForm">
                        <div class="mb-3">
                            <label for="channelName" class="form-label">Channel Name</label>
                            <input type="text" class="form-control" id="channelName" required>
                        </div>
                        <div class="mb-3">
                            <label for="channelType" class="form-label">Channel Type</label>
                            <select class="form-select" id="channelType" required>
                                <option value="text">Text Channel</option>
                                <option value="voice">Voice Channel</option>
                                <option value="category">Category</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="channelParent" class="form-label">Parent Category</label>
                            <select class="form-select" id="channelParent">
                                <option value="">None</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="channelTopic" class="form-label">Topic (Text channels only)</label>
                            <textarea class="form-control" id="channelTopic" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Channel</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Channel Modal -->
    <div class="modal fade" id="editChannelModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Channel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editChannelForm">
                        <input type="hidden" id="editChannelId">
                        <div class="mb-3">
                            <label for="editChannelName" class="form-label">Channel Name</label>
                            <input type="text" class="form-control" id="editChannelName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editChannelParent" class="form-label">Parent Category</label>
                            <select class="form-select" id="editChannelParent">
                                <option value="">None</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editChannelTopic" class="form-label">Topic (Text channels only)</label>
                            <textarea class="form-control" id="editChannelTopic" rows="2"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="editChannelPosition" class="form-label">Position</label>
                            <input type="number" class="form-control" id="editChannelPosition">
                        </div>
                        <button type="submit" class="btn btn-primary">Update Channel</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Role Modal -->
    <div class="modal fade" id="createRoleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Role</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createRoleForm">
                        <div class="mb-3">
                            <label for="roleName" class="form-label">Role Name</label>
                            <input type="text" class="form-control" id="roleName" required>
                        </div>
                        <div class="mb-3">
                            <label for="roleColor" class="form-label">Role Color</label>
                            <div class="d-flex align-items-center">
                                <input type="color" class="form-control color-picker me-2" id="roleColor" value="#7289da">
                                <input type="text" class="form-control" id="roleColorHex" value="#7289da">
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="roleHoist">
                            <label class="form-check-label" for="roleHoist">Display separately from online members</label>
                        </div>
                        <div class="mb-3">
                            <label for="rolePosition" class="form-label">Position</label>
                            <input type="number" class="form-control" id="rolePosition">
                        </div>
                        <div class="mb-3">
                            <label for="rolePermissions" class="form-label">Permissions</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permCreateInstantInvite">
                                <label class="form-check-label" for="permCreateInstantInvite">Create Instant Invite</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permKickMembers">
                                <label class="form-check-label" for="permKickMembers">Kick Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permBanMembers">
                                <label class="form-check-label" for="permBanMembers">Ban Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permAdministrator">
                                <label class="form-check-label" for="permAdministrator">Administrator</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageChannels">
                                <label class="form-check-label" for="permManageChannels">Manage Channels</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageGuild">
                                <label class="form-check-label" for="permManageGuild">Manage Server</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permAddReactions">
                                <label class="form-check-label" for="permAddReactions">Add Reactions</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permViewAuditLog">
                                <label class="form-check-label" for="permViewAuditLog">View Audit Log</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permPrioritySpeaker">
                                <label class="form-check-label" for="permPrioritySpeaker">Priority Speaker</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permStream">
                                <label class="form-check-label" for="permStream">Stream</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permViewChannel">
                                <label class="form-check-label" for="permViewChannel">View Channel</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permSendMessages">
                                <label class="form-check-label" for="permSendMessages">Send Messages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permSendTTSMessages">
                                <label class="form-check-label" for="permSendTTSMessages">Send TTS Messages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageMessages">
                                <label class="form-check-label" for="permManageMessages">Manage Messages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permEmbedLinks">
                                <label class="form-check-label" for="permEmbedLinks">Embed Links</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permAttachFiles">
                                <label class="form-check-label" for="permAttachFiles">Attach Files</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permReadMessageHistory">
                                <label class="form-check-label" for="permReadMessageHistory">Read Message History</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permMentionEveryone">
                                <label class="form-check-label" for="permMentionEveryone">Mention @everyone, @here, and All Roles</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permUseExternalEmojis">
                                <label class="form-check-label" for="permUseExternalEmojis">Use External Emojis</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permViewGuildInsights">
                                <label class="form-check-label" for="permViewGuildInsights">View Server Insights</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permConnect">
                                <label class="form-check-label" for="permConnect">Connect</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permSpeak">
                                <label class="form-check-label" for="permSpeak">Speak</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permMuteMembers">
                                <label class="form-check-label" for="permMuteMembers">Mute Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permDeafenMembers">
                                <label class="form-check-label" for="permDeafenMembers">Deafen Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permMoveMembers">
                                <label class="form-check-label" for="permMoveMembers">Move Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permUseVAD">
                                <label class="form-check-label" for="permUseVAD">Use Voice Activity</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permChangeNickname">
                                <label class="form-check-label" for="permChangeNickname">Change Nickname</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageNicknames">
                                <label class="form-check-label" for="permManageNicknames">Manage Nicknames</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageRoles">
                                <label class="form-check-label" for="permManageRoles">Manage Roles</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageWebhooks">
                                <label class="form-check-label" for="permManageWebhooks">Manage Webhooks</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="permManageEmojisAndStickers">
                                <label class="form-check-label" for="permManageEmojisAndStickers">Manage Emojis and Stickers</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Create Role</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Role Modal -->
    <div class="modal fade" id="editRoleModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Role</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editRoleForm">
                        <input type="hidden" id="editRoleId">
                        <div class="mb-3">
                            <label for="editRoleName" class="form-label">Role Name</label>
                            <input type="text" class="form-control" id="editRoleName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editRoleColor" class="form-label">Role Color</label>
                            <div class="d-flex align-items-center">
                                <input type="color" class="form-control color-picker me-2" id="editRoleColor">
                                <input type="text" class="form-control" id="editRoleColorHex">
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="editRoleHoist">
                            <label class="form-check-label" for="editRoleHoist">Display separately from online members</label>
                        </div>
                        <div class="mb-3">
                            <label for="editRolePosition" class="form-label">Position</label>
                            <input type="number" class="form-control" id="editRolePosition">
                        </div>
                        <div class="mb-3">
                            <label for="editRolePermissions" class="form-label">Permissions</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermCreateInstantInvite">
                                <label class="form-check-label" for="editPermCreateInstantInvite">Create Instant Invite</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermKickMembers">
                                <label class="form-check-label" for="editPermKickMembers">Kick Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermBanMembers">
                                <label class="form-check-label" for="editPermBanMembers">Ban Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermAdministrator">
                                <label class="form-check-label" for="editPermAdministrator">Administrator</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageChannels">
                                <label class="form-check-label" for="editPermManageChannels">Manage Channels</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageGuild">
                                <label class="form-check-label" for="editPermManageGuild">Manage Server</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermAddReactions">
                                <label class="form-check-label" for="editPermAddReactions">Add Reactions</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermViewAuditLog">
                                <label class="form-check-label" for="editPermViewAuditLog">View Audit Log</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermPrioritySpeaker">
                                <label class="form-check-label" for="editPermPrioritySpeaker">Priority Speaker</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermStream">
                                <label class="form-check-label" for="editPermStream">Stream</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermViewChannel">
                                <label class="form-check-label" for="editPermViewChannel">View Channel</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermSendMessages">
                                <label class="form-check-label" for="editPermSendMessages">Send Messages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermSendTTSMessages">
                                <label class="form-check-label" for="editPermSendTTSMessages">Send TTS Messages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageMessages">
                                <label class="form-check-label" for="editPermManageMessages">Manage Messages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermEmbedLinks">
                                <label class="form-check-label" for="editPermEmbedLinks">Embed Links</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermAttachFiles">
                                <label class="form-check-label" for="editPermAttachFiles">Attach Files</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermReadMessageHistory">
                                <label class="form-check-label" for="editPermReadMessageHistory">Read Message History</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermMentionEveryone">
                                <label class="form-check-label" for="editPermMentionEveryone">Mention @everyone, @here, and All Roles</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermUseExternalEmojis">
                                <label class="form-check-label" for="editPermUseExternalEmojis">Use External Emojis</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermViewGuildInsights">
                                <label class="form-check-label" for="editPermViewGuildInsights">View Server Insights</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermConnect">
                                <label class="form-check-label" for="editPermConnect">Connect</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermSpeak">
                                <label class="form-check-label" for="editPermSpeak">Speak</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermMuteMembers">
                                <label class="form-check-label" for="editPermMuteMembers">Mute Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermDeafenMembers">
                                <label class="form-check-label" for="editPermDeafenMembers">Deafen Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermMoveMembers">
                                <label class="form-check-label" for="editPermMoveMembers">Move Members</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermUseVAD">
                                <label class="form-check-label" for="editPermUseVAD">Use Voice Activity</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermChangeNickname">
                                <label class="form-check-label" for="editPermChangeNickname">Change Nickname</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageNicknames">
                                <label class="form-check-label" for="editPermManageNicknames">Manage Nicknames</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageRoles">
                                <label class="form-check-label" for="editPermManageRoles">Manage Roles</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageWebhooks">
                                <label class="form-check-label" for="editPermManageWebhooks">Manage Webhooks</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="editPermManageEmojisAndStickers">
                                <label class="form-check-label" for="editPermManageEmojisAndStickers">Manage Emojis and Stickers</label>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Role</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Kick Member Modal -->
    <div class="modal fade" id="kickMemberModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Kick Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="kickMemberForm">
                        <input type="hidden" id="kickMemberId">
                        <div class="mb-3">
                            <label for="kickReason" class="form-label">Reason</label>
                            <textarea class="form-control" id="kickReason" rows="3"></textarea>
                        </div>
                        <div class="alert alert-warning">
                            <i class="bi bi-exclamation-triangle"></i> Are you sure you want to kick this member? They will be able to rejoin with an invite.
                        </div>
                        <button type="submit" class="btn btn-danger">Kick Member</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Ban Member Modal -->
    <div class="modal fade" id="banMemberModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Ban Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="banMemberForm">
                        <input type="hidden" id="banMemberId">
                        <div class="mb-3">
                            <label for="banReason" class="form-label">Reason</label>
                            <textarea class="form-control" id="banReason" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="deleteMessageDays" class="form-label">Delete message history</label>
                            <select class="form-select" id="deleteMessageDays">
                                <option value="0">Don't delete any</option>
                                <option value="1">Last 24 hours</option>
                                <option value="2">Last 2 days</option>
                                <option value="3">Last 3 days</option>
                                <option value="4">Last 4 days</option>
                                <option value="5">Last 5 days</option>
                                <option value="6">Last 6 days</option>
                                <option value="7">Last 7 days</option>
                            </select>
                        </div>
                        <div class="alert alert-danger">
                            <i class="bi bi-exclamation-triangle"></i> Are you sure you want to ban this member? They will not be able to rejoin unless unbanned.
                        </div>
                        <button type="submit" class="btn btn-danger">Ban Member</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Send Message Modal -->
    <div class="modal fade" id="sendMessageModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Send Message</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="sendMessageForm">
                        <input type="hidden" id="sendMessageChannelId">
                        <div class="mb-3">
                            <label for="messageContent" class="form-label">Message Content</label>
                            <textarea class="form-control" id="messageContent" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sendAsEmbed">
                                <label class="form-check-label" for="sendAsEmbed">Send as Embed</label>
                            </div>
                        </div>
                        <div id="embedOptions" style="display: none;">
                            <div class="mb-3">
                                <label for="embedTitle" class="form-label">Embed Title</label>
                                <input type="text" class="form-control" id="embedTitle">
                            </div>
                            <div class="mb-3">
                                <label for="embedDescription" class="form-label">Embed Description</label>
                                <textarea class="form-control" id="embedDescription" rows="3"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="embedColor" class="form-label">Embed Color</label>
                                <div class="d-flex align-items-center">
                                    <input type="color" class="form-control color-picker me-2" id="embedColor" value="#7289da">
                                    <input type="text" class="form-control" id="embedColorHex" value="#7289da">
                                </div>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Send Message</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let apiUrl = '';
        let authToken = '';
        let currentGuildId = '';
        let currentChannelId = '';
        let currentRoleId = '';
        let currentMemberId = '';

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboard = document.getElementById('dashboard');
        const loginBtn = document.getElementById('loginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const guildSelect = document.getElementById('guildSelect');
        const notification = document.getElementById('notification');
        const tabLinks = document.querySelectorAll('.nav-link');
        const tabContents = document.querySelectorAll('.tab-content');

        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', () => {
            const savedApiUrl = localStorage.getItem('apiUrl');
            const savedAuthToken = localStorage.getItem('authToken');
            
            if (savedApiUrl && savedAuthToken) {
                apiUrl = savedApiUrl;
                authToken = savedAuthToken;
                document.getElementById('apiUrl').value = apiUrl;
                document.getElementById('webToken').value = authToken;
                showDashboard();
            }
        });

        // Login button click event
        loginBtn.addEventListener('click', async () => {
            apiUrl = document.getElementById('apiUrl').value.trim();
            const webToken = document.getElementById('webToken').value.trim();
            
            if (!apiUrl || !webToken) {
                showNotification('Please enter both API URL and Web Token', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${apiUrl}/api/auth`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ token: webToken })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    authToken = webToken;
                    localStorage.setItem('apiUrl', apiUrl);
                    localStorage.setItem('authToken', authToken);
                    showDashboard();
                } else {
                    showNotification(data.message || 'Authentication failed', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Failed to connect to the API server', 'error');
            }
        });

        // Logout button click event
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('apiUrl');
            localStorage.removeItem('authToken');
            apiUrl = '';
            authToken = '';
            currentGuildId = '';
            showLoginScreen();
        });

        // Guild select change event
        guildSelect.addEventListener('change', (e) => {
            currentGuildId = e.target.value;
            if (currentGuildId) {
                loadGuildData();
                const activeTab = document.querySelector('.nav-link.active').getAttribute('data-tab');
                showTab(activeTab);
            }
        });

        // Tab navigation
        tabLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const tabName = link.getAttribute('data-tab');
                showTab(tabName);
            });
        });

        // Show dashboard
        function showDashboard() {
            loginScreen.style.display = 'none';
            dashboard.style.display = 'block';
            loadGuilds();
        }

        // Show login screen
        function showLoginScreen() {
            loginScreen.style.display = 'block';
            dashboard.style.display = 'none';
        }

        // Show tab
        function showTab(tabName) {
            // Update active tab link
            tabLinks.forEach(link => {
                if (link.getAttribute('data-tab') === tabName) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Show selected tab content
            tabContents.forEach(content => {
                if (content.id === `${tabName}Tab`) {
                    content.style.display = 'block';
                } else {
                    content.style.display = 'none';
                }
            });
            
            // Load tab data
            if (!currentGuildId) return;
            
            switch (tabName) {
                case 'overview':
                    loadOverview();
                    break;
                case 'channels':
                    loadChannels();
                    break;
                case 'roles':
                    loadRoles();
                    break;
                case 'members':
                    loadMembers();
                    break;
                case 'messages':
                    loadMessageChannels();
                    break;
                case 'settings':
                    loadServerSettings();
                    break;
            }
        }

        // Load guilds
        async function loadGuilds() {
            try {
                const response = await fetch(`${apiUrl}/api/guilds`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load guilds');
                }
                
                const guilds = await response.json();
                
                // Clear existing options
                guildSelect.innerHTML = '<option value="">Select a server...</option>';
                
                // Add guild options
                guilds.forEach(guild => {
                    const option = document.createElement('option');
                    option.value = guild.id;
                    option.textContent = guild.name;
                    guildSelect.appendChild(option);
                });
                
                // Auto-select first guild if available
                if (guilds.length > 0 && !currentGuildId) {
                    currentGuildId = guilds[0].id;
                    guildSelect.value = currentGuildId;
                    loadGuildData();
                    showTab('overview');
                }
                
                showNotification('Guilds loaded successfully');
            } catch (error) {
                console.error('Error loading guilds:', error);
                showNotification('Failed to load guilds', 'error');
            }
        }

        // Load guild data
        async function loadGuildData() {
            if (!currentGuildId) return;
            
            try {
                // Load server settings for overview
                const settingsResponse = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/settings`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (settingsResponse.ok) {
                    const settings = await settingsResponse.json();
                    document.getElementById('serverInfo').innerHTML = `
                        <div class="row">
                            <div class="col-md-6">
                                <p><strong>Server Name:</strong> ${settings.name}</p>
                                <p><strong>Server ID:</strong> ${currentGuildId}</p>
                                <p><strong>Region:</strong> ${settings.region}</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Verification Level:</strong> ${getVerificationLevelText(settings.verificationLevel)}</p>
                                <p><strong>Explicit Content Filter:</strong> ${getExplicitContentFilterText(settings.explicitContentFilter)}</p>
                                <p><strong>Default Notifications:</strong> ${getDefaultMessageNotificationsText(settings.defaultMessageNotifications)}</p>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading guild data:', error);
            }
        }

        // Load overview data
        async function loadOverview() {
            if (!currentGuildId) return;
            
            try {
                // Load channels
                const channelsResponse = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/channels`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (channelsResponse.ok) {
                    const channels = await channelsResponse.json();
                    document.getElementById('channelCount').textContent = channels.length;
                }
                
                // Load roles
                const rolesResponse = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/roles`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (rolesResponse.ok) {
                    const roles = await rolesResponse.json();
                    document.getElementById('roleCount').textContent = roles.length;
                }
                
                // Load members
                const membersResponse = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/members`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (membersResponse.ok) {
                    const members = await membersResponse.json();
                    document.getElementById('memberCount').textContent = members.length;
                    
                    // Count online members (simplified - in a real bot, you'd check presence status)
                    const onlineCount = members.filter(member => {
                        // This is a simplified check - in a real implementation, you'd check the presence status
                        return Math.random() > 0.5; // Random for demo purposes
                    }).length;
                    
                    document.getElementById('onlineCount').textContent = onlineCount;
                }
            } catch (error) {
                console.error('Error loading overview data:', error);
                showNotification('Failed to load overview data', 'error');
            }
        }

        // Load channels
        async function loadChannels() {
            if (!currentGuildId) return;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/channels`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load channels');
                }
                
                const channels = await response.json();
                
                // Sort channels by position
                channels.sort((a, b) => a.position - b.position);
                
                // Group channels by category
                const categories = {};
                const uncategorizedChannels = [];
                
                channels.forEach(channel => {
                    if (channel.type === 4) { // Category
                        categories[channel.id] = {
                            name: channel.name,
                            channels: []
                        };
                    } else if (channel.parentId) {
                        if (categories[channel.parentId]) {
                            categories[channel.parentId].channels.push(channel);
                        }
                    } else {
                        uncategorizedChannels.push(channel);
                    }
                });
                
                // Build HTML
                let html = '';
                
                // Add uncategorized channels
                if (uncategorizedChannels.length > 0) {
                    html += '<h6 class="mt-3 mb-2">Uncategorized</h6>';
                    uncategorizedChannels.forEach(channel => {
                        html += createChannelItem(channel);
                    });
                }
                
                // Add categories and their channels
                Object.keys(categories).forEach(categoryId => {
                    const category = categories[categoryId];
                    html += `<h6 class="mt-3 mb-2">${getChannelIcon(4)} ${category.name}</h6>`;
                    
                    category.channels.forEach(channel => {
                        html += createChannelItem(channel);
                    });
                });
                
                document.getElementById('channelsList').innerHTML = html || '<p>No channels found</p>';
                
                // Add event listeners to channel action buttons
                addChannelEventListeners();
                
                // Update parent channel selects
                updateParentChannelSelects(channels);
            } catch (error) {
                console.error('Error loading channels:', error);
                showNotification('Failed to load channels', 'error');
                document.getElementById('channelsList').innerHTML = '<p class="text-danger">Failed to load channels</p>';
            }
        }

        // Create channel item HTML
        function createChannelItem(channel) {
            return `
                <div class="channel-item" data-channel-id="${channel.id}">
                    <div>
                        ${getChannelIcon(channel.type)} ${channel.name}
                        ${channel.topic ? `<small class="text-muted d-block">${channel.topic}</small>` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-sm btn-primary edit-channel-btn" data-channel-id="${channel.id}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-danger delete-channel-btn" data-channel-id="${channel.id}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }

        // Get channel icon
        function getChannelIcon(type) {
            switch (type) {
                case 0: // Text
                    return '<i class="bi bi-hash"></i>';
                case 2: // Voice
                    return '<i class="bi bi-volume-up"></i>';
                case 4: // Category
                    return '<i class="bi bi-folder"></i>';
                case 5: // News
                    return '<i class="bi bi-newspaper"></i>';
                case 13: // Stage
                    return '<i class="bi bi-camera-video"></i>';
                default:
                    return '<i class="bi bi-hash"></i>';
            }
        }

        // Add event listeners to channel action buttons
        function addChannelEventListeners() {
            // Edit channel buttons
            document.querySelectorAll('.edit-channel-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const channelId = e.currentTarget.getAttribute('data-channel-id');
                    editChannel(channelId);
                });
            });
            
            // Delete channel buttons
            document.querySelectorAll('.delete-channel-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const channelId = e.currentTarget.getAttribute('data-channel-id');
                    if (confirm('Are you sure you want to delete this channel?')) {
                        deleteChannel(channelId);
                    }
                });
            });
        }

        // Update parent channel selects
        function updateParentChannelSelects(channels) {
            const categories = channels.filter(channel => channel.type === 4);
            
            // Update create channel modal
            const channelParentSelect = document.getElementById('channelParent');
            channelParentSelect.innerHTML = '<option value="">None</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                channelParentSelect.appendChild(option);
            });
            
            // Update edit channel modal
            const editChannelParentSelect = document.getElementById('editChannelParent');
            editChannelParentSelect.innerHTML = '<option value="">None</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                editChannelParentSelect.appendChild(option);
            });
        }

        // Create channel
        document.getElementById('createChannelBtn').addEventListener('click', () => {
            const modal = new bootstrap.Modal(document.getElementById('createChannelModal'));
            modal.show();
        });

        document.getElementById('createChannelForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('channelName').value;
            const type = document.getElementById('channelType').value;
            const parentId = document.getElementById('channelParent').value;
            const topic = document.getElementById('channelTopic').value;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/channels`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        type,
                        parentId: parentId || null,
                        topic
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Channel created successfully');
                    bootstrap.Modal.getInstance(document.getElementById('createChannelModal')).hide();
                    document.getElementById('createChannelForm').reset();
                    loadChannels();
                } else {
                    showNotification(data.message || 'Failed to create channel', 'error');
                }
            } catch (error) {
                console.error('Error creating channel:', error);
                showNotification('Failed to create channel', 'error');
            }
        });

        // Edit channel
        async function editChannel(channelId) {
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/channels`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load channels');
                }
                
                const channels = await response.json();
                const channel = channels.find(c => c.id === channelId);
                
                if (!channel) {
                    showNotification('Channel not found', 'error');
                    return;
                }
                
                // Populate form fields
                document.getElementById('editChannelId').value = channel.id;
                document.getElementById('editChannelName').value = channel.name;
                document.getElementById('editChannelParent').value = channel.parentId || '';
                document.getElementById('editChannelTopic').value = channel.topic || '';
                document.getElementById('editChannelPosition').value = channel.position;
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('editChannelModal'));
                modal.show();
            } catch (error) {
                console.error('Error loading channel for edit:', error);
                showNotification('Failed to load channel data', 'error');
            }
        }

        document.getElementById('editChannelForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const channelId = document.getElementById('editChannelId').value;
            const name = document.getElementById('editChannelName').value;
            const parentId = document.getElementById('editChannelParent').value;
            const topic = document.getElementById('editChannelTopic').value;
            const position = parseInt(document.getElementById('editChannelPosition').value);
            
            try {
                const response = await fetch(`${apiUrl}/api/channels/${channelId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        parentId: parentId || null,
                        topic,
                        position
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Channel updated successfully');
                    bootstrap.Modal.getInstance(document.getElementById('editChannelModal')).hide();
                    loadChannels();
                } else {
                    showNotification(data.message || 'Failed to update channel', 'error');
                }
            } catch (error) {
                console.error('Error updating channel:', error);
                showNotification('Failed to update channel', 'error');
            }
        });

        // Delete channel
        async function deleteChannel(channelId) {
            try {
                const response = await fetch(`${apiUrl}/api/channels/${channelId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Channel deleted successfully');
                    loadChannels();
                } else {
                    showNotification(data.message || 'Failed to delete channel', 'error');
                }
            } catch (error) {
                console.error('Error deleting channel:', error);
                showNotification('Failed to delete channel', 'error');
            }
        }

        // Load roles
        async function loadRoles() {
            if (!currentGuildId) return;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/roles`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load roles');
                }
                
                const roles = await response.json();
                
                // Sort roles by position
                roles.sort((a, b) => b.position - a.position);
                
                // Build HTML
                let html = '';
                roles.forEach(role => {
                    html += `
                        <div class="role-item" data-role-id="${role.id}">
                            <div>
                                <span class="badge" style="background-color: #${role.color.toString(16).padStart(6, '0')}">${role.name}</span>
                                ${role.hoist ? '<i class="bi bi-pin-angle"></i>' : ''}
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-sm btn-primary edit-role-btn" data-role-id="${role.id}">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-role-btn" data-role-id="${role.id}">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('rolesList').innerHTML = html || '<p>No roles found</p>';
                
                // Add event listeners to role action buttons
                addRoleEventListeners();
            } catch (error) {
                console.error('Error loading roles:', error);
                showNotification('Failed to load roles', 'error');
                document.getElementById('rolesList').innerHTML = '<p class="text-danger">Failed to load roles</p>';
            }
        }

        // Add event listeners to role action buttons
        function addRoleEventListeners() {
            // Edit role buttons
            document.querySelectorAll('.edit-role-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const roleId = e.currentTarget.getAttribute('data-role-id');
                    editRole(roleId);
                });
            });
            
            // Delete role buttons
            document.querySelectorAll('.delete-role-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const roleId = e.currentTarget.getAttribute('data-role-id');
                    if (confirm('Are you sure you want to delete this role?')) {
                        deleteRole(roleId);
                    }
                });
            });
        }

        // Create role
        document.getElementById('createRoleBtn').addEventListener('click', () => {
            const modal = new bootstrap.Modal(document.getElementById('createRoleModal'));
            modal.show();
        });

        // Color picker sync
        document.getElementById('roleColor').addEventListener('input', (e) => {
            document.getElementById('roleColorHex').value = e.target.value;
        });

        document.getElementById('roleColorHex').addEventListener('input', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                document.getElementById('roleColor').value = e.target.value;
            }
        });

        document.getElementById('editRoleColor').addEventListener('input', (e) => {
            document.getElementById('editRoleColorHex').value = e.target.value;
        });

        document.getElementById('editRoleColorHex').addEventListener('input', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                document.getElementById('editRoleColor').value = e.target.value;
            }
        });

        document.getElementById('embedColor').addEventListener('input', (e) => {
            document.getElementById('embedColorHex').value = e.target.value;
        });

        document.getElementById('embedColorHex').addEventListener('input', (e) => {
            if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
                document.getElementById('embedColor').value = e.target.value;
            }
        });

        // Send as embed checkbox
        document.getElementById('sendAsEmbed').addEventListener('change', (e) => {
            document.getElementById('embedOptions').style.display = e.target.checked ? 'block' : 'none';
        });

        document.getElementById('createRoleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('roleName').value;
            const color = parseInt(document.getElementById('roleColor').value.substring(1), 16);
            const hoist = document.getElementById('roleHoist').checked;
            const position = parseInt(document.getElementById('rolePosition').value) || 0;
            
            // Get permissions
            const permissions = getPermissionsFromCheckboxes('perm');
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/roles`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        color,
                        hoist,
                        position,
                        permissions
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Role created successfully');
                    bootstrap.Modal.getInstance(document.getElementById('createRoleModal')).hide();
                    document.getElementById('createRoleForm').reset();
                    loadRoles();
                } else {
                    showNotification(data.message || 'Failed to create role', 'error');
                }
            } catch (error) {
                console.error('Error creating role:', error);
                showNotification('Failed to create role', 'error');
            }
        });

        // Edit role
        async function editRole(roleId) {
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/roles`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load roles');
                }
                
                const roles = await response.json();
                const role = roles.find(r => r.id === roleId);
                
                if (!role) {
                    showNotification('Role not found', 'error');
                    return;
                }
                
                // Populate form fields
                document.getElementById('editRoleId').value = role.id;
                document.getElementById('editRoleName').value = role.name;
                document.getElementById('editRoleColor').value = `#${role.color.toString(16).padStart(6, '0')}`;
                document.getElementById('editRoleColorHex').value = `#${role.color.toString(16).padStart(6, '0')}`;
                document.getElementById('editRoleHoist').checked = role.hoist;
                document.getElementById('editRolePosition').value = role.position;
                
                // Set permissions
                const permissions = new Discord.Permissions(BigInt(role.permissions));
                setPermissionCheckboxes('editPerm', permissions);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('editRoleModal'));
                modal.show();
            } catch (error) {
                console.error('Error loading role for edit:', error);
                showNotification('Failed to load role data', 'error');
            }
        }

        document.getElementById('editRoleForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const roleId = document.getElementById('editRoleId').value;
            const name = document.getElementById('editRoleName').value;
            const color = parseInt(document.getElementById('editRoleColor').value.substring(1), 16);
            const hoist = document.getElementById('editRoleHoist').checked;
            const position = parseInt(document.getElementById('editRolePosition').value) || 0;
            
            // Get permissions
            const permissions = getPermissionsFromCheckboxes('editPerm');
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/roles/${roleId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        color,
                        hoist,
                        position,
                        permissions
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Role updated successfully');
                    bootstrap.Modal.getInstance(document.getElementById('editRoleModal')).hide();
                    loadRoles();
                } else {
                    showNotification(data.message || 'Failed to update role', 'error');
                }
            } catch (error) {
                console.error('Error updating role:', error);
                showNotification('Failed to update role', 'error');
            }
        });

        // Delete role
        async function deleteRole(roleId) {
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/roles/${roleId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Role deleted successfully');
                    loadRoles();
                } else {
                    showNotification(data.message || 'Failed to delete role', 'error');
                }
            } catch (error) {
                console.error('Error deleting role:', error);
                showNotification('Failed to delete role', 'error');
            }
        }

        // Get permissions from checkboxes
        function getPermissionsFromCheckboxes(prefix) {
            let permissions = 0n;
            
            if (document.getElementById(`${prefix}CreateInstantInvite`).checked) permissions |= Discord.PermissionsBitFlags.CreateInstantInvite;
            if (document.getElementById(`${prefix}KickMembers`).checked) permissions |= Discord.PermissionsBitFlags.KickMembers;
            if (document.getElementById(`${prefix}BanMembers`).checked) permissions |= Discord.PermissionsBitFlags.BanMembers;
            if (document.getElementById(`${prefix}Administrator`).checked) permissions |= Discord.PermissionsBitFlags.Administrator;
            if (document.getElementById(`${prefix}ManageChannels`).checked) permissions |= Discord.PermissionsBitFlags.ManageChannels;
            if (document.getElementById(`${prefix}ManageGuild`).checked) permissions |= Discord.PermissionsBitFlags.ManageGuild;
            if (document.getElementById(`${prefix}AddReactions`).checked) permissions |= Discord.PermissionsBitFlags.AddReactions;
            if (document.getElementById(`${prefix}ViewAuditLog`).checked) permissions |= Discord.PermissionsBitFlags.ViewAuditLog;
            if (document.getElementById(`${prefix}PrioritySpeaker`).checked) permissions |= Discord.PermissionsBitFlags.PrioritySpeaker;
            if (document.getElementById(`${prefix}Stream`).checked) permissions |= Discord.PermissionsBitFlags.Stream;
            if (document.getElementById(`${prefix}ViewChannel`).checked) permissions |= Discord.PermissionsBitFlags.ViewChannel;
            if (document.getElementById(`${prefix}SendMessages`).checked) permissions |= Discord.PermissionsBitFlags.SendMessages;
            if (document.getElementById(`${prefix}SendTTSMessages`).checked) permissions |= Discord.PermissionsBitFlags.SendTTSMessages;
            if (document.getElementById(`${prefix}ManageMessages`).checked) permissions |= Discord.PermissionsBitFlags.ManageMessages;
            if (document.getElementById(`${prefix}EmbedLinks`).checked) permissions |= Discord.PermissionsBitFlags.EmbedLinks;
            if (document.getElementById(`${prefix}AttachFiles`).checked) permissions |= Discord.PermissionsBitFlags.AttachFiles;
            if (document.getElementById(`${prefix}ReadMessageHistory`).checked) permissions |= Discord.PermissionsBitFlags.ReadMessageHistory;
            if (document.getElementById(`${prefix}MentionEveryone`).checked) permissions |= Discord.PermissionsBitFlags.MentionEveryone;
            if (document.getElementById(`${prefix}UseExternalEmojis`).checked) permissions |= Discord.PermissionsBitFlags.UseExternalEmojis;
            if (document.getElementById(`${prefix}ViewGuildInsights`).checked) permissions |= Discord.PermissionsBitFlags.ViewGuildInsights;
            if (document.getElementById(`${prefix}Connect`).checked) permissions |= Discord.PermissionsBitFlags.Connect;
            if (document.getElementById(`${prefix}Speak`).checked) permissions |= Discord.PermissionsBitFlags.Speak;
            if (document.getElementById(`${prefix}MuteMembers`).checked) permissions |= Discord.PermissionsBitFlags.MuteMembers;
            if (document.getElementById(`${prefix}DeafenMembers`).checked) permissions |= Discord.PermissionsBitFlags.DeafenMembers;
            if (document.getElementById(`${prefix}MoveMembers`).checked) permissions |= Discord.PermissionsBitFlags.MoveMembers;
            if (document.getElementById(`${prefix}UseVAD`).checked) permissions |= Discord.PermissionsBitFlags.UseVAD;
            if (document.getElementById(`${prefix}ChangeNickname`).checked) permissions |= Discord.PermissionsBitFlags.ChangeNickname;
            if (document.getElementById(`${prefix}ManageNicknames`).checked) permissions |= Discord.PermissionsBitFlags.ManageNicknames;
            if (document.getElementById(`${prefix}ManageRoles`).checked) permissions |= Discord.PermissionsBitFlags.ManageRoles;
            if (document.getElementById(`${prefix}ManageWebhooks`).checked) permissions |= Discord.PermissionsBitFlags.ManageWebhooks;
            if (document.getElementById(`${prefix}ManageEmojisAndStickers`).checked) permissions |= Discord.PermissionsBitFlags.ManageEmojisAndStickers;
            
            return permissions.toString();
        }

        // Set permission checkboxes
        function setPermissionCheckboxes(prefix, permissions) {
            document.getElementById(`${prefix}CreateInstantInvite`).checked = permissions.has(Discord.PermissionsBitFlags.CreateInstantInvite);
            document.getElementById(`${prefix}KickMembers`).checked = permissions.has(Discord.PermissionsBitFlags.KickMembers);
            document.getElementById(`${prefix}BanMembers`).checked = permissions.has(Discord.PermissionsBitFlags.BanMembers);
            document.getElementById(`${prefix}Administrator`).checked = permissions.has(Discord.PermissionsBitFlags.Administrator);
            document.getElementById(`${prefix}ManageChannels`).checked = permissions.has(Discord.PermissionsBitFlags.ManageChannels);
            document.getElementById(`${prefix}ManageGuild`).checked = permissions.has(Discord.PermissionsBitFlags.ManageGuild);
            document.getElementById(`${prefix}AddReactions`).checked = permissions.has(Discord.PermissionsBitFlags.AddReactions);
            document.getElementById(`${prefix}ViewAuditLog`).checked = permissions.has(Discord.PermissionsBitFlags.ViewAuditLog);
            document.getElementById(`${prefix}PrioritySpeaker`).checked = permissions.has(Discord.PermissionsBitFlags.PrioritySpeaker);
            document.getElementById(`${prefix}Stream`).checked = permissions.has(Discord.PermissionsBitFlags.Stream);
            document.getElementById(`${prefix}ViewChannel`).checked = permissions.has(Discord.PermissionsBitFlags.ViewChannel);
            document.getElementById(`${prefix}SendMessages`).checked = permissions.has(Discord.PermissionsBitFlags.SendMessages);
            document.getElementById(`${prefix}SendTTSMessages`).checked = permissions.has(Discord.PermissionsBitFlags.SendTTSMessages);
            document.getElementById(`${prefix}ManageMessages`).checked = permissions.has(Discord.PermissionsBitFlags.ManageMessages);
            document.getElementById(`${prefix}EmbedLinks`).checked = permissions.has(Discord.PermissionsBitFlags.EmbedLinks);
            document.getElementById(`${prefix}AttachFiles`).checked = permissions.has(Discord.PermissionsBitFlags.AttachFiles);
            document.getElementById(`${prefix}ReadMessageHistory`).checked = permissions.has(Discord.PermissionsBitFlags.ReadMessageHistory);
            document.getElementById(`${prefix}MentionEveryone`).checked = permissions.has(Discord.PermissionsBitFlags.MentionEveryone);
            document.getElementById(`${prefix}UseExternalEmojis`).checked = permissions.has(Discord.PermissionsBitFlags.UseExternalEmojis);
            document.getElementById(`${prefix}ViewGuildInsights`).checked = permissions.has(Discord.PermissionsBitFlags.ViewGuildInsights);
            document.getElementById(`${prefix}Connect`).checked = permissions.has(Discord.PermissionsBitFlags.Connect);
            document.getElementById(`${prefix}Speak`).checked = permissions.has(Discord.PermissionsBitFlags.Speak);
            document.getElementById(`${prefix}MuteMembers`).checked = permissions.has(Discord.PermissionsBitFlags.MuteMembers);
            document.getElementById(`${prefix}DeafenMembers`).checked = permissions.has(Discord.PermissionsBitFlags.DeafenMembers);
            document.getElementById(`${prefix}MoveMembers`).checked = permissions.has(Discord.PermissionsBitFlags.MoveMembers);
            document.getElementById(`${prefix}UseVAD`).checked = permissions.has(Discord.PermissionsBitFlags.UseVAD);
            document.getElementById(`${prefix}ChangeNickname`).checked = permissions.has(Discord.PermissionsBitFlags.ChangeNickname);
            document.getElementById(`${prefix}ManageNicknames`).checked = permissions.has(Discord.PermissionsBitFlags.ManageNicknames);
            document.getElementById(`${prefix}ManageRoles`).checked = permissions.has(Discord.PermissionsBitFlags.ManageRoles);
            document.getElementById(`${prefix}ManageWebhooks`).checked = permissions.has(Discord.PermissionsBitFlags.ManageWebhooks);
            document.getElementById(`${prefix}ManageEmojisAndStickers`).checked = permissions.has(Discord.PermissionsBitFlags.ManageEmojisAndStickers);
        }

        // Load members
        async function loadMembers() {
            if (!currentGuildId) return;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/members`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load members');
                }
                
                const members = await response.json();
                
                // Sort members by username
                members.sort((a, b) => a.username.localeCompare(b.username));
                
                // Build HTML
                let html = '';
                members.forEach(member => {
                    html += `
                        <div class="member-item" data-member-id="${member.id}">
                            <div>
                                <div class="d-flex align-items-center">
                                    <img src="${member.avatar || `https://cdn.discordapp.com/embed/avatars/${parseInt(member.discriminator) % 5}.png`}" alt="${member.username}" class="rounded-circle me-2" width="32" height="32">
                                    <div>
                                        <div>${member.nickname ? `${member.nickname} (${member.username}#${member.discriminator})` : `${member.username}#${member.discriminator}`}</div>
                                        <small class="text-muted">Joined: ${new Date(member.joinedAt).toLocaleDateString()}</small>
                                    </div>
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-sm btn-warning kick-member-btn" data-member-id="${member.id}" data-member-name="${member.username}">
                                    <i class="bi bi-person-dash"></i>
                                </button>
                                <button class="btn btn-sm btn-danger ban-member-btn" data-member-id="${member.id}" data-member-name="${member.username}">
                                    <i class="bi bi-person-x"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('membersList').innerHTML = html || '<p>No members found</p>';
                
                // Add event listeners to member action buttons
                addMemberEventListeners();
                
                // Add search functionality
                document.getElementById('memberSearch').addEventListener('input', (e) => {
                    const searchTerm = e.target.value.toLowerCase();
                    document.querySelectorAll('.member-item').forEach(item => {
                        const text = item.textContent.toLowerCase();
                        item.style.display = text.includes(searchTerm) ? 'flex' : 'none';
                    });
                });
            } catch (error) {
                console.error('Error loading members:', error);
                showNotification('Failed to load members', 'error');
                document.getElementById('membersList').innerHTML = '<p class="text-danger">Failed to load members</p>';
            }
        }

        // Add event listeners to member action buttons
        function addMemberEventListeners() {
            // Kick member buttons
            document.querySelectorAll('.kick-member-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const memberId = e.currentTarget.getAttribute('data-member-id');
                    const memberName = e.currentTarget.getAttribute('data-member-name');
                    kickMember(memberId, memberName);
                });
            });
            
            // Ban member buttons
            document.querySelectorAll('.ban-member-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const memberId = e.currentTarget.getAttribute('data-member-id');
                    const memberName = e.currentTarget.getAttribute('data-member-name');
                    banMember(memberId, memberName);
                });
            });
        }

        // Kick member
        function kickMember(memberId, memberName) {
            document.getElementById('kickMemberId').value = memberId;
            document.getElementById('kickReason').value = '';
            
            const modal = new bootstrap.Modal(document.getElementById('kickMemberModal'));
            modal.show();
        }

        document.getElementById('kickMemberForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const memberId = document.getElementById('kickMemberId').value;
            const reason = document.getElementById('kickReason').value;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/members/${memberId}/kick`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        reason
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Member kicked successfully');
                    bootstrap.Modal.getInstance(document.getElementById('kickMemberModal')).hide();
                    loadMembers();
                } else {
                    showNotification(data.message || 'Failed to kick member', 'error');
                }
            } catch (error) {
                console.error('Error kicking member:', error);
                showNotification('Failed to kick member', 'error');
            }
        });

        // Ban member
        function banMember(memberId, memberName) {
            document.getElementById('banMemberId').value = memberId;
            document.getElementById('banReason').value = '';
            document.getElementById('deleteMessageDays').value = '0';
            
            const modal = new bootstrap.Modal(document.getElementById('banMemberModal'));
            modal.show();
        }

        document.getElementById('banMemberForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const memberId = document.getElementById('banMemberId').value;
            const reason = document.getElementById('banReason').value;
            const deleteMessageDays = parseInt(document.getElementById('deleteMessageDays').value);
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/members/${memberId}/ban`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        reason,
                        deleteMessageDays
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Member banned successfully');
                    bootstrap.Modal.getInstance(document.getElementById('banMemberModal')).hide();
                    loadMembers();
                } else {
                    showNotification(data.message || 'Failed to ban member', 'error');
                }
            } catch (error) {
                console.error('Error banning member:', error);
                showNotification('Failed to ban member', 'error');
            }
        });

        // Load message channels
        async function loadMessageChannels() {
            if (!currentGuildId) return;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/channels`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load channels');
                }
                
                const channels = await response.json();
                const textChannels = channels.filter(channel => channel.type === 0); // Text channels only
                
                // Clear existing options
                const messageChannelSelect = document.getElementById('messageChannelSelect');
                messageChannelSelect.innerHTML = '<option value="">Select a channel...</option>';
                
                // Add channel options
                textChannels.forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel.id;
                    option.textContent = channel.name;
                    messageChannelSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading message channels:', error);
                showNotification('Failed to load channels', 'error');
            }
        }

        // Load messages
        document.getElementById('loadMessagesBtn').addEventListener('click', async () => {
            const channelId = document.getElementById('messageChannelSelect').value;
            const limit = parseInt(document.getElementById('messageLimit').value);
            
            if (!channelId) {
                showNotification('Please select a channel', 'error');
                return;
            }
            
            currentChannelId = channelId;
            
            try {
                const response = await fetch(`${apiUrl}/api/channels/${channelId}/messages?limit=${limit}`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load messages');
                }
                
                const messages = await response.json();
                
                // Build HTML
                let html = '';
                messages.forEach(message => {
                    html += `
                        <div class="message-content" data-message-id="${message.id}">
                            <div class="message-header">
                                <span class="message-author">${message.author.username}#${message.author.discriminator}</span>
                                <span class="message-timestamp">${new Date(message.timestamp).toLocaleString()}</span>
                            </div>
                            <div class="message-body">${escapeHtml(message.content)}</div>
                            ${message.attachments.length > 0 ? `
                                <div class="message-attachments">
                                    <strong>Attachments:</strong>
                                    <ul>
                                        ${message.attachments.map(attachment => `
                                            <li><a href="${attachment.url}" target="_blank">${attachment.filename}</a> (${formatBytes(attachment.size)})</li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            <div class="message-actions mt-2">
                                <button class="btn btn-sm btn-danger delete-message-btn" data-message-id="${message.id}">
                                    <i class="bi bi-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('messagesList').innerHTML = html || '<p>No messages found</p>';
                
                // Add event listeners to message action buttons
                document.querySelectorAll('.delete-message-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const messageId = e.currentTarget.getAttribute('data-message-id');
                        if (confirm('Are you sure you want to delete this message?')) {
                            deleteMessage(messageId);
                        }
                    });
                });
            } catch (error) {
                console.error('Error loading messages:', error);
                showNotification('Failed to load messages', 'error');
                document.getElementById('messagesList').innerHTML = '<p class="text-danger">Failed to load messages</p>';
            }
        });

        // Send message
        document.getElementById('sendMessageBtn').addEventListener('click', () => {
            const channelId = document.getElementById('messageChannelSelect').value;
            
            if (!channelId) {
                showNotification('Please select a channel', 'error');
                return;
            }
            
            currentChannelId = channelId;
            document.getElementById('sendMessageChannelId').value = channelId;
            document.getElementById('messageContent').value = '';
            document.getElementById('sendAsEmbed').checked = false;
            document.getElementById('embedOptions').style.display = 'none';
            document.getElementById('embedTitle').value = '';
            document.getElementById('embedDescription').value = '';
            document.getElementById('embedColor').value = '#7289da';
            document.getElementById('embedColorHex').value = '#7289da';
            
            const modal = new bootstrap.Modal(document.getElementById('sendMessageModal'));
            modal.show();
        });

        document.getElementById('sendMessageForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const channelId = document.getElementById('sendMessageChannelId').value;
            const content = document.getElementById('messageContent').value;
            const sendAsEmbed = document.getElementById('sendAsEmbed').checked;
            
            let body = { content };
            
            if (sendAsEmbed) {
                const embedTitle = document.getElementById('embedTitle').value;
                const embedDescription = document.getElementById('embedDescription').value;
                const embedColor = parseInt(document.getElementById('embedColor').value.substring(1), 16);
                
                body.embed = {
                    title: embedTitle || undefined,
                    description: embedDescription || undefined,
                    color: embedColor
                };
            }
            
            try {
                const response = await fetch(`${apiUrl}/api/channels/${channelId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Message sent successfully');
                    bootstrap.Modal.getInstance(document.getElementById('sendMessageModal')).hide();
                    document.getElementById('sendMessageForm').reset();
                    
                    // Reload messages if we're viewing the channel
                    if (currentChannelId === channelId) {
                        document.getElementById('loadMessagesBtn').click();
                    }
                } else {
                    showNotification(data.message || 'Failed to send message', 'error');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('Failed to send message', 'error');
            }
        });

        // Delete message
        async function deleteMessage(messageId) {
            try {
                const response = await fetch(`${apiUrl}/api/channels/${currentChannelId}/messages/${messageId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Message deleted successfully');
                    // Remove message from DOM
                    const messageElement = document.querySelector(`.message-content[data-message-id="${messageId}"]`);
                    if (messageElement) {
                        messageElement.remove();
                    }
                } else {
                    showNotification(data.message || 'Failed to delete message', 'error');
                }
            } catch (error) {
                console.error('Error deleting message:', error);
                showNotification('Failed to delete message', 'error');
            }
        }

        // Load server settings
        async function loadServerSettings() {
            if (!currentGuildId) return;
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/settings`, {
                    headers: {
                        'Authorization': authToken
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to load server settings');
                }
                
                const settings = await response.json();
                
                // Populate form fields
                document.getElementById('serverName').value = settings.name;
                document.getElementById('serverRegion').value = settings.region;
                document.getElementById('verificationLevel').value = settings.verificationLevel;
                document.getElementById('explicitContentFilter').value = settings.explicitContentFilter;
                document.getElementById('defaultMessageNotifications').value = settings.defaultMessageNotifications;
            } catch (error) {
                console.error('Error loading server settings:', error);
                showNotification('Failed to load server settings', 'error');
            }
        }

        // Save server settings
        document.getElementById('serverSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('serverName').value;
            const region = document.getElementById('serverRegion').value;
            const verificationLevel = parseInt(document.getElementById('verificationLevel').value);
            const explicitContentFilter = parseInt(document.getElementById('explicitContentFilter').value);
            const defaultMessageNotifications = parseInt(document.getElementById('defaultMessageNotifications').value);
            
            try {
                const response = await fetch(`${apiUrl}/api/guilds/${currentGuildId}/settings`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': authToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name,
                        region,
                        verificationLevel,
                        explicitContentFilter,
                        defaultMessageNotifications
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Server settings updated successfully');
                    loadGuildData();
                } else {
                    showNotification(data.message || 'Failed to update server settings', 'error');
                }
            } catch (error) {
                console.error('Error updating server settings:', error);
                showNotification('Failed to update server settings', 'error');
            }
        });

        // Show notification
        function showNotification(message, type = 'success') {
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
        }

        // Helper functions
        function getVerificationLevelText(level) {
            switch (level) {
                case 0: return 'None';
                case 1: return 'Low';
                case 2: return 'Medium';
                case 3: return 'High';
                case 4: return 'Very High';
                default: return 'Unknown';
            }
        }

        function getExplicitContentFilterText(level) {
            switch (level) {
                case 0: return 'Disabled';
                case 1: return 'Members without roles';
                case 2: return 'All members';
                default: return 'Unknown';
            }
        }

        function getDefaultMessageNotificationsText(level) {
            switch (level) {
                case 0: return 'All messages';
                case 1: return 'Only mentions';
                default: return 'Unknown';
            }
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
